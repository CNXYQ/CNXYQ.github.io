<!-- build time:Sun Jul 12 2020 15:37:43 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html lang="zh-Hans" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>布隆过滤器和HyperLogLog | 路漫漫其修远兮 吾将上下而求索</title><meta name="description" content="python-布隆过滤器在学习redis过程中提到一个缓存穿透的问题， 书中参考的解决方案之一是使用布隆过滤器， 那么就有必要来了解一下什么是布隆过滤器。在参考了许多博客之后， 写个总结记录一下。一、布隆过滤器简介什么是布隆过滤器？本质上布隆过滤器( BloomFilter )是一种数据结构，比较巧妙的概率型数据结构（probabilistic data structure），特点是高效地插入和查"><meta name="keywords" content="布隆过滤器,搜索算法,HyperLogLog"><meta name="author" content="轻北"><meta name="copyright" content="轻北"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/logo.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="dns-prefetch" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"><link rel="dns-prefetch" href="https://fonts.googleapis.com"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="dns-prefetch" href="//busuanzi.ibruce.info"><meta name="baidu-site-verification" content="https://ziyuan.baidu.com/property/index?site=http://www.qing-bei.com/#/"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="布隆过滤器和HyperLogLog"><meta name="twitter:description" content="python-布隆过滤器在学习redis过程中提到一个缓存穿透的问题， 书中参考的解决方案之一是使用布隆过滤器， 那么就有必要来了解一下什么是布隆过滤器。在参考了许多博客之后， 写个总结记录一下。一、布隆过滤器简介什么是布隆过滤器？本质上布隆过滤器( BloomFilter )是一种数据结构，比较巧妙的概率型数据结构（probabilistic data structure），特点是高效地插入和查"><meta name="twitter:image" content="https://wx1.sbimg.cn/2020/06/16/pexels-photo-2657669.jpg"><meta property="og:type" content="article"><meta property="og:title" content="布隆过滤器和HyperLogLog"><meta property="og:url" content="http://www.qing-bei.com/2020/07/01/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8%E5%92%8CHyperLogLog/"><meta property="og:site_name" content="路漫漫其修远兮 吾将上下而求索"><meta property="og:description" content="python-布隆过滤器在学习redis过程中提到一个缓存穿透的问题， 书中参考的解决方案之一是使用布隆过滤器， 那么就有必要来了解一下什么是布隆过滤器。在参考了许多博客之后， 写个总结记录一下。一、布隆过滤器简介什么是布隆过滤器？本质上布隆过滤器( BloomFilter )是一种数据结构，比较巧妙的概率型数据结构（probabilistic data structure），特点是高效地插入和查"><meta property="og:image" content="https://wx1.sbimg.cn/2020/06/16/pexels-photo-2657669.jpg"><meta property="article:published_time" content="2020-07-01T09:28:37.000Z"><meta property="article:modified_time" content="2020-07-12T07:19:29.514Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>function activateDarkMode(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#000")}function activateLightMode(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#fff")}var autoChangeMode="1",t=Cookies.get("theme");if("1"==autoChangeMode){var isDarkMode=window.matchMedia("(prefers-color-scheme: dark)").matches,isLightMode=window.matchMedia("(prefers-color-scheme: light)").matches,isNotSpecified=window.matchMedia("(prefers-color-scheme: no-preference)").matches,hasNoSupport=!isDarkMode&&!isLightMode&&!isNotSpecified;if(void 0===t){if(isLightMode)activateLightMode();else if(isDarkMode)activateDarkMode();else if(isNotSpecified||hasNoSupport){console.log("You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.");var now=new Date,hour=now.getHours(),isNight=hour<6||hour>=18;isNight?activateDarkMode():activateLightMode()}}else"light"==t?activateLightMode():activateDarkMode()}else"2"==autoChangeMode?(now=new Date,hour=now.getHours(),isNight=hour<6||hour>=18,void 0===t?isNight?activateDarkMode():activateLightMode():"light"===t?activateLightMode():activateDarkMode()):"dark"==t?activateDarkMode():"light"==t&&activateLightMode()</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://www.qing-bei.com/2020/07/01/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8%E5%92%8CHyperLogLog/"><link rel="prev" title="Python bcrypy模块" href="http://www.qing-bei.com/2020/07/10/Python%20bcrypt%E6%A8%A1%E5%9D%97/"><link rel="next" title="Hive内嵌安装、本地安装和常见属性配置" href="http://www.qing-bei.com/2020/06/18/Hive%E5%86%85%E5%B5%8C%E6%A8%A1%E5%BC%8F%E5%AE%89%E8%A3%85/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"We didn't find any results for the search: ${query}"}},translate:{defaultEncoding:2,translateDelay:0,cookieDomain:"https://xxx/",msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"簡"},copy:{success:"Copy successfully",error:"Copy error",noSupport:"The browser does not support"},bookmark:{message_prev:"Press",message_next:"to bookmark this page"},runtime_unit:"days",runtime:!0,copyright:void 0,ClickShowText:{text:"富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善",fontSize:"15px"},medium_zoom:!1,fancybox:!0,Snackbar:void 0,baiduPush:!0,highlightCopy:!0,highlightLang:!0,highlightShrink:"false",isFontAwesomeV5:!1,isPhotoFigcaption:!1,islazyload:!1,isanchor:!1}</script><script>var GLOBAL_CONFIG_SITE={isPost:!0,isHome:!1,isSidebar:!0}</script><noscript><style>#page-header{opacity:1}.justified-gallery img{opacity:1}</style></noscript><link rel="stylesheet" href="/css/footerjianbian.css"><link rel="stylesheet" href="/css/siderbargundong.css"><link rel="stylesheet" href="/css/backgroundRgba.css"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="路漫漫其修远兮 吾将上下而求索" type="application/atom+xml"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://wx1.sbimg.cn/2020/06/08/me.jpg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">18</div></a></div></div><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">18</div></a></div></div><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">18</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#python-布隆过滤器"><span class="toc-number">1.</span> <span class="toc-text">python-布隆过滤器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、布隆过滤器简介"><span class="toc-number">1.1.</span> <span class="toc-text">一、布隆过滤器简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#什么是布隆过滤器？"><span class="toc-number">1.1.1.</span> <span class="toc-text">什么是布隆过滤器？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#布隆过滤器原理"><span class="toc-number">1.1.2.</span> <span class="toc-text">布隆过滤器原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#布隆过滤器的准确性"><span class="toc-number">1.1.3.</span> <span class="toc-text">布隆过滤器的准确性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#布隆过滤器的应用"><span class="toc-number">1.1.4.</span> <span class="toc-text">布隆过滤器的应用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、python中使用布隆过滤器"><span class="toc-number">1.2.</span> <span class="toc-text">二、python中使用布隆过滤器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、redis中使用布隆过滤器"><span class="toc-number">1.3.</span> <span class="toc-text">三、redis中使用布隆过滤器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装"><span class="toc-number">1.3.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#命令"><span class="toc-number">1.3.2.</span> <span class="toc-text">命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#reserve"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">reserve</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#add-madd"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">add, madd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#exists-mexists"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">exists, mexists</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四、python程序中使用redisbloom"><span class="toc-number">1.4.</span> <span class="toc-text">四、python程序中使用redisbloom</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#五、缓存穿透"><span class="toc-number">1.5.</span> <span class="toc-text">五、缓存穿透</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HyperLogLog"><span class="toc-number">2.</span> <span class="toc-text">HyperLogLog</span></a></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image:url(https://wx1.sbimg.cn/2020/06/16/pexels-photo-2657669.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">路漫漫其修远兮 吾将上下而求索</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">布隆过滤器和HyperLogLog</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="Created 2020-07-01 17:28:37"><i class="fa fa-calendar" aria-hidden="true"></i> Created 2020-07-01</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="Updated 2020-07-12 15:19:29"><i class="fa fa-history" aria-hidden="true"></i> Updated 2020-07-12</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/">布隆过滤器</a><i class="fa fa-angle-right post-meta__separator" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/python/">python</a><i class="fa fa-angle-right post-meta__separator" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/python/HyperLogLog/">HyperLogLog</a><i class="fa fa-angle-right post-meta__separator" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/python/HyperLogLog/%E6%90%9C%E7%B4%A2%E7%AE%97%E6%B3%95/">搜索算法</a></span></div><div class="meta-secondline"><span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>Word count:</span><span class="word-count">3.2k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>Reading time: 11 min</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>Post View:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="python-布隆过滤器"><a href="#python-布隆过滤器" class="headerlink" title="python-布隆过滤器"></a>python-布隆过滤器</h1><p>在学习<code>redis</code>过程中提到一个缓存穿透的问题， 书中参考的解决方案之一是使用布隆过滤器， 那么就有必要来了解一下什么是布隆过滤器。在参考了许多博客之后， 写个总结记录一下。</p><h2 id="一、布隆过滤器简介"><a href="#一、布隆过滤器简介" class="headerlink" title="一、布隆过滤器简介"></a>一、布隆过滤器简介</h2><h3 id="什么是布隆过滤器？"><a href="#什么是布隆过滤器？" class="headerlink" title="什么是布隆过滤器？"></a>什么是布隆过滤器？</h3><p>本质上布隆过滤器( BloomFilter )是一种数据结构，比较巧妙的概率型数据结构（probabilistic data structure），特点是高效地插入和查询，可以用来告诉你 “某样东西一定不存在或者可能存在”。</p><p>相比于传统的 Set、Map 等数据结构，它更高效、占用空间更少，但是缺点是其返回的结果是概率性的，而不是确切的。</p><h3 id="布隆过滤器原理"><a href="#布隆过滤器原理" class="headerlink" title="布隆过滤器原理"></a>布隆过滤器原理</h3><p>布隆过滤器内部维护一个<code>bitArray</code>(位数组)， 开始所有数据全部置 0 。当一个元素过来时，能过多个哈希函数（hash1,hash2,hash3….）计算不同的在哈希值，并通过哈希值找到对应的<code>bitArray</code>下标处，将里面的值 0 置为 1 。 需要说明的是，布隆过滤器有一个误判率的概念，误判率越低，则数组越长，所占空间越大。误判率越高则数组越小，所占的空间越小。</p><p>下面以网址为例来进行说明, 例如布隆过滤器的初始情况如下图所示：<br><a href="https://img2018.cnblogs.com/blog/1534894/201912/1534894-20191207205013684-856617678.jpg" target="_blank" rel="noopener"><img src="https://img2018.cnblogs.com/blog/1534894/201912/1534894-20191207205013684-856617678.jpg" alt="img"></a></p><p>现在我们需要往布隆过滤里中插入<code>baidu</code>这个url，经过3个哈希函数的计算，hash值分别为1，4，7，那么我们就需要对布隆过滤器的对应的bit位置1， 就如图下所示：</p><p><a href="https://img2018.cnblogs.com/blog/1534894/201912/1534894-20191207205051490-438287903.jpg" target="_blank" rel="noopener"><img src="https://img2018.cnblogs.com/blog/1534894/201912/1534894-20191207205051490-438287903.jpg" alt="img"></a></p><p>接下来，需要继续往布隆过滤器中添加<code>tencent</code>这个url，然后它计算出来的hash值分别3，4，8，继续往对应的bit位置1。这里就需要注意一个点， 上面两个url最后计算出来的hash值都有4，这个现象也是布隆不能确认某个元素一定存在的原因，最后如下图所示：</p><p><a href="https://img2018.cnblogs.com/blog/1534894/201912/1534894-20191207205113779-698386268.jpg" target="_blank" rel="noopener"><img src="https://img2018.cnblogs.com/blog/1534894/201912/1534894-20191207205113779-698386268.jpg" alt="img"></a></p><p>布隆过滤器的查询也很简单，例如我们需要查找<code>python</code>，只需要计算出它的hash值， 如果该值为2，4，7，那么因为对应bit位上的数据有一个不为1， 那么一定可以断言<code>python</code>不存在，但是如果它计算的hash值是1，3，7，那么就只能判断出<code>python</code>可能存在，这个例子就可以看出来， 我们没有存入<code>python</code>，但是由于其他key存储的时候返回的hash值正好将<code>python</code>计算出来的hash值对应的bit位占用了，这样就不能准确地判断出<code>python</code>是否存在。</p><p>因此， 随着添加的值越来越多， 被占的bit位越来越多， 这时候误判的可能性就开始变高，如果布隆过滤器所有bit位都被置为1的话，那么所有key都有可能存在， 这时候布隆过滤器也就失去了过滤的功能。至此，选择一个合适的过滤器长度就显得非常重要。</p><p>从上面布隆过滤器的实现原理可以看出，它不支持删除， 一旦将某个key对应的bit位置0，可能会导致同样bit位的其他key的存在性判断错误。</p><h3 id="布隆过滤器的准确性"><a href="#布隆过滤器的准确性" class="headerlink" title="布隆过滤器的准确性"></a>布隆过滤器的准确性</h3><p>布隆过滤器的核心思想有两点：</p><ol><li>多个hash，增大随机性，减少hash碰撞的概率</li><li>扩大数组范围，使hash值均匀分布，进一步减少hash碰撞的概率。</li></ol><p>虽然布隆过滤器已经尽可能的减小hash碰撞的概率了，但是，并不能彻底消除，因此正如上面的小例子所举的小例子的结果来看， 布隆过滤器只能告诉我们<strong>某样东西一定不存在以及它可能存在</strong>。</p><p>关于布隆过滤器的数组大小以及相应的hash函数个数的选择， 可以参考网上的其他博客或者是这个维基百科上对应词条上的结果: <a href="http://en.wikipedia.org/wiki/Bloom_filter#Probability_of_false_positives" target="_blank" rel="noopener">Probability of false positives</a> .</p><p><a href="https://img2018.cnblogs.com/blog/1534894/201912/1534894-20191207205508471-460587233.png" target="_blank" rel="noopener"><img src="https://img2018.cnblogs.com/blog/1534894/201912/1534894-20191207205508471-460587233.png" alt="1024px-Bloom_filter_fp_probability.svg"></a></p><p>上图的纵坐标p是误判率，横坐标n表示插入的元素个数，m表示布隆过滤器的bit长度，当然上图结果成立都假设hash函数的个数k满足条件<code>k = (m/n)ln2</code>(忽略k是整数)。</p><p>从上面的结果来看， 选择合适后误判率还是比较低的。</p><h3 id="布隆过滤器的应用"><a href="#布隆过滤器的应用" class="headerlink" title="布隆过滤器的应用"></a>布隆过滤器的应用</h3><ol><li>网页爬虫对URL的去重，避免爬取相同的URL地址</li><li>反垃圾邮件，从数十亿个垃圾邮件列表中判断某邮箱是否垃圾邮箱（同理，垃圾短信）</li><li>缓存穿透，将所有可能存在的数据缓存放到布隆过滤器中，当黑客访问不存在的缓存时迅速返回避免缓存及DB挂掉。</li><li>黑名单过滤，</li></ol><h2 id="二、python中使用布隆过滤器"><a href="#二、python中使用布隆过滤器" class="headerlink" title="二、python中使用布隆过滤器"></a>二、python中使用布隆过滤器</h2><ol><li><p>先去这个网站下载<code>bitarray</code>这个依赖 <code>https://www.lfd.uci.edu/~gohlke/pythonlibs/#bitarray</code></p><p>直接安装会报错<code>error: Microsoft Visual C++ 14.0 is required. Get it with &quot;Build Tools for Visual Studio&quot;: https://visualstudio.microsoft.com/downloads/</code></p></li><li><p>安装<code>wheel</code>文件, 防止我们主动安装报这样的错误<code>pip3 install bitarray-1.1.0-cp36-cp36m-win_amd64.whl</code></p></li></ol><p>注: 如果不知道怎么确定版本可以查看这个链接 <a href="https://blog.csdn.net/happywlg123/article/details/107281936" target="_blank" rel="noopener">https://blog.csdn.net/happywlg123/article/details/107281936</a></p><ol start="3"><li><code>pip3 install pybloom_live</code></li></ol><p>使用案例：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Copyfrom pybloom_live <span class="keyword">import</span> ScalableBloomFilter, BloomFilter</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可自动扩容的布隆过滤器</span></span><br><span class="line">bloom = ScalableBloomFilter(initial_capacity=<span class="number">100</span>, error_rate=<span class="number">0.001</span>)</span><br><span class="line"></span><br><span class="line">url1 = <span class="string">'http://www.baidu.com'</span></span><br><span class="line">url2 = <span class="string">'http://qq.com'</span></span><br><span class="line"></span><br><span class="line">bloom.add(url1)</span><br><span class="line">print(url1 <span class="keyword">in</span> bloom)</span><br><span class="line">print(url2 <span class="keyword">in</span> bloom)</span><br><span class="line">Copy<span class="comment"># BloomFilter 是定长的</span></span><br><span class="line"><span class="keyword">from</span> pybloom_live <span class="keyword">import</span> BloomFilter</span><br><span class="line"></span><br><span class="line">url1 = <span class="string">'http://www.baidu.com'</span></span><br><span class="line">url2 = <span class="string">'http://qq.com'</span></span><br><span class="line"></span><br><span class="line">bf = BloomFilter(capacity=<span class="number">1000</span>)</span><br><span class="line">bf.add(url1)</span><br><span class="line">print(url1 <span class="keyword">in</span> bf)</span><br><span class="line">print(url2 <span class="keyword">in</span> bf)</span><br></pre></td></tr></table></figure><h2 id="三、redis中使用布隆过滤器"><a href="#三、redis中使用布隆过滤器" class="headerlink" title="三、redis中使用布隆过滤器"></a>三、redis中使用布隆过滤器</h2><p>详细的文档可以参考<a href="https://oss.redislabs.com/redisbloom/Quick_Start/" target="_blank" rel="noopener">官方文档</a>。</p><p>这个模块不仅仅实现了布隆过滤器，还实现了 <code>CuckooFilter</code>（布谷鸟过滤器），以及 <code>TopK</code>功能。<code>CuckooFilter</code>是在 <code>BloomFilter</code>的基础上主要解决了<code>BloomFilter</code>不能删除的缺点。 下面只说明了布隆过滤器</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>传统的<code>redis</code>服务器安装 <code>RedisBloom</code> 插件，详情可以参考<a href="https://blog.csdn.net/u013030276/article/details/88350641" target="_blank" rel="noopener">centos中安装redis插件bloom-filter</a></p><p>我这里使用docker进行安装，简单快捷。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Copydocker pull redislabs/rebloom:latest</span><br><span class="line">docker run -p 6379:6379 --name redis-redisbloom redislabs/rebloom:latest</span><br><span class="line">docker <span class="built_in">exec</span> -it redis-redisbloom /bin/bash</span><br></pre></td></tr></table></figure><h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><p>命令使用非常简单。</p><h4 id="reserve"><a href="#reserve" class="headerlink" title="reserve"></a>reserve</h4><blockquote><p>bf.reserve {key} {error_rate} {size}</p></blockquote><p>创建一个空的名为<code>key</code>的布隆过滤器，并设置一个期望的错误率和初始大小。<code>{error_rate}</code>过滤器的错误率在0-1之间，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Copy127.0.0.1:6379&gt; bf.reserve black_male 0.001 1000</span><br><span class="line">OK</span><br></pre></td></tr></table></figure><h4 id="add-madd"><a href="#add-madd" class="headerlink" title="add, madd"></a>add, madd</h4><blockquote><p>bf.add {key} {item}</p><p>bf.madd {key} {item} [item…]</p></blockquote><p>往过滤器中添加元素。如果key不存在，过滤器会自动创建。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Copy127.0.0.1:6379&gt; bf.add <span class="built_in">test</span> 123</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; bf.madd urls baidu google tencent</span><br><span class="line">1) (<span class="built_in">integer</span>) 0</span><br><span class="line">2) (<span class="built_in">integer</span>) 0</span><br><span class="line">3) (<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上面已经存在的值再次添加会返回0， 不存在则返回1</span></span><br></pre></td></tr></table></figure><h4 id="exists-mexists"><a href="#exists-mexists" class="headerlink" title="exists, mexists"></a>exists, mexists</h4><blockquote><p>bf.exists {key} {item}</p><p>bf.mexists {key} {item} [item…]</p></blockquote><p>判断过滤器中是否存在该元素，不存在返回0，存在返回1。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Copy127.0.0.1:6379&gt; bf.exists <span class="built_in">test</span> 123</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; bf.mexists urls baidu google hello</span><br><span class="line">1) (<span class="built_in">integer</span>) 1</span><br><span class="line">2) (<span class="built_in">integer</span>) 1</span><br><span class="line">3) (<span class="built_in">integer</span>) 0</span><br></pre></td></tr></table></figure><h2 id="四、python程序中使用redisbloom"><a href="#四、python程序中使用redisbloom" class="headerlink" title="四、python程序中使用redisbloom"></a>四、python程序中使用redisbloom</h2><p>使用<code>redisbloom</code>这个模块来操作<code>redis</code>的布隆过滤器插件</p><blockquote><p>pip3 install redisbloom</p></blockquote><p>使用方法，参考官方给出的例子即可。<a href="https://github.com/RedisBloom/redisbloom-py" target="_blank" rel="noopener">https://github.com/RedisBloom/redisbloom-py</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Copy<span class="comment"># 自己的简单使用</span></span><br><span class="line"><span class="keyword">from</span> redisbloom.client <span class="keyword">import</span> Client</span><br><span class="line"></span><br><span class="line"><span class="comment"># 因为我使用的是虚拟机中docker的redis, 填写虚拟机的ip地址和暴露的端口</span></span><br><span class="line">rb = Client(host=<span class="string">'192.168.12.78'</span>, port=<span class="number">6379</span>)</span><br><span class="line">rb.bfAdd(<span class="string">'urls'</span>, <span class="string">'baidu'</span>)</span><br><span class="line">rb.bfAdd(<span class="string">'urls'</span>, <span class="string">'google'</span>)</span><br><span class="line">print(rb.bfExists(<span class="string">'urls'</span>, <span class="string">'baidu'</span>))  <span class="comment"># out: 1</span></span><br><span class="line">print(rb.bfExists(<span class="string">'urls'</span>, <span class="string">'tencent'</span>))  <span class="comment"># out: 0</span></span><br><span class="line"></span><br><span class="line">rb.bfMAdd(<span class="string">'urls'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>)</span><br><span class="line">print(rb.bfMExists(<span class="string">'urls'</span>, <span class="string">'google'</span>, <span class="string">'baidu'</span>, <span class="string">'tencent'</span>))  <span class="comment"># out: [1, 1, 0]</span></span><br></pre></td></tr></table></figure><p><strong>误判率的测试demo</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">Copy<span class="string">"""</span></span><br><span class="line"><span class="string">基于redis布隆过滤器的误判率的测试</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> redisbloom.client <span class="keyword">import</span> Client</span><br><span class="line"></span><br><span class="line">rb = Client(host=<span class="string">'192.168.12.78'</span>, port=<span class="number">6379</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(size, key=<span class="string">'book'</span>)</span>:</span></span><br><span class="line">    <span class="string">"""插入数据"""</span></span><br><span class="line">    <span class="comment"># 一条条插入速度太慢了</span></span><br><span class="line">    <span class="comment"># for i in range(size):</span></span><br><span class="line">    <span class="comment">#     rb.bfAdd(key, f'book&#123;i&#125;')</span></span><br><span class="line">    s = time.time()</span><br><span class="line">    step = <span class="number">1000</span>  <span class="comment"># 每次插入1000条数据</span></span><br><span class="line">    <span class="keyword">for</span> start <span class="keyword">in</span> range(<span class="number">0</span>, size, step):</span><br><span class="line">        stop = start + step</span><br><span class="line">        <span class="keyword">if</span> stop &gt;= size:</span><br><span class="line">            stop = size</span><br><span class="line">        rb.bfMAdd(key, *range(start, stop))</span><br><span class="line">    print(<span class="string">'插入结束... 花费时间: &#123;:.4f&#125;s'</span>.format(time.time() - s))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">select</span><span class="params">(size, key=<span class="string">'book'</span>)</span>:</span></span><br><span class="line">    <span class="string">"""查询数据"""</span></span><br><span class="line">    <span class="comment"># 统计误判个数</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    s = time.time()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 单条查询速度太慢了。。。</span></span><br><span class="line">    <span class="comment"># for i in range(size, size * 2):</span></span><br><span class="line">    <span class="comment">#     count += rb.bfExists(key, i)</span></span><br><span class="line"></span><br><span class="line">    step = <span class="number">1000</span>  <span class="comment"># 每次查1000条数据</span></span><br><span class="line">    <span class="keyword">for</span> start <span class="keyword">in</span> range(size, size * <span class="number">2</span>, step):</span><br><span class="line">        stop = start + step</span><br><span class="line">        <span class="keyword">if</span> stop &gt;= size * <span class="number">2</span>:</span><br><span class="line">            stop = size * <span class="number">2</span></span><br><span class="line">        count += rb.bfMExists(key, *range(start, stop)).count(<span class="number">1</span>)  <span class="comment"># 返回值[1, 0, 1, ...]统计1的个数</span></span><br><span class="line">    print(<span class="string">'size: &#123;&#125;, 误判元素个数: &#123;&#125;, 误判率&#123;:.4%&#125;'</span>.format(size, count, count / size))</span><br><span class="line">    print(<span class="string">'查询结束... 花费时间: &#123;:.4f&#125;s'</span>.format(time.time() - s))</span><br><span class="line">    print(<span class="string">'*'</span> * <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_test1</span><span class="params">(size, key=<span class="string">'book'</span>)</span>:</span></span><br><span class="line">    <span class="string">"""测试size个不存在的"""</span></span><br><span class="line">    rb.delete(key)  <span class="comment"># 先清空原来的key</span></span><br><span class="line">    insert(size, key)</span><br><span class="line">    select(size, key)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_test2</span><span class="params">(size, error=<span class="number">0.001</span>, key=<span class="string">'book'</span>)</span>:</span></span><br><span class="line">    <span class="string">"""指定误差率和初始大小的布隆过滤器"""</span></span><br><span class="line">    rb.delete(key)</span><br><span class="line"></span><br><span class="line">    rb.bfCreate(key, error, size)  <span class="comment"># 误差率为0.1%， 初始个数为size</span></span><br><span class="line"></span><br><span class="line">    insert(size, key)</span><br><span class="line">    select(size, key)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># The default error rate is 0.01 and the default initial capacity is 100.</span></span><br><span class="line">    <span class="comment"># 这个是默认的配置， 初始大小为100， 误差率默认为0.01</span></span><br><span class="line">    _test1(<span class="number">1000</span>)</span><br><span class="line">    _test1(<span class="number">10000</span>)</span><br><span class="line">    _test1(<span class="number">100000</span>)</span><br><span class="line">    _test2(<span class="number">500000</span>)</span><br><span class="line">Copy<span class="comment"># 输出的结果</span></span><br><span class="line"></span><br><span class="line">插入结束... 花费时间: <span class="number">0.0409</span>s</span><br><span class="line">size: <span class="number">1000</span>, 误判元素个数: <span class="number">14</span>, 误判率<span class="number">1.4000</span>%</span><br><span class="line">查询结束... 花费时间: <span class="number">0.0060</span>s</span><br><span class="line">******************************</span><br><span class="line">插入结束... 花费时间: <span class="number">0.1389</span>s</span><br><span class="line">size: <span class="number">10000</span>, 误判元素个数: <span class="number">110</span>, 误判率<span class="number">1.1000</span>%</span><br><span class="line">查询结束... 花费时间: <span class="number">0.0628</span>s</span><br><span class="line">******************************</span><br><span class="line">插入结束... 花费时间: <span class="number">0.5372</span>s</span><br><span class="line">size: <span class="number">100000</span>, 误判元素个数: <span class="number">1419</span>, 误判率<span class="number">1.4190</span>%</span><br><span class="line">查询结束... 花费时间: <span class="number">0.4318</span>s</span><br><span class="line">******************************</span><br><span class="line">插入结束... 花费时间: <span class="number">1.9484</span>s</span><br><span class="line">size: <span class="number">500000</span>, 误判元素个数: <span class="number">152</span>, 误判率<span class="number">0.0304</span>%</span><br><span class="line">查询结束... 花费时间: <span class="number">2.2177</span>s</span><br><span class="line">******************************</span><br></pre></td></tr></table></figure><p>如果想要布隆过滤器知道具体的耗费内存大小以及对应的错误率的信息， 可以使用查看这个<a href="https://krisives.github.io/bloom-calculator/" target="_blank" rel="noopener">布隆过滤器计算器</a>计算出最后的结果。就如下面所示， 1kw数据， 误差为0.01%， 只需要23M内存。</p><p><a href="https://img2018.cnblogs.com/blog/1534894/201912/1534894-20191207205337366-2116880413.png" target="_blank" rel="noopener"><img src="https://img2018.cnblogs.com/blog/1534894/201912/1534894-20191207205337366-2116880413.png" alt="img"></a></p><h2 id="五、缓存穿透"><a href="#五、缓存穿透" class="headerlink" title="五、缓存穿透"></a>五、缓存穿透</h2><p>现在又回到开头的问题， 解决缓存穿透的问题。</p><p><strong>什么是缓存穿透</strong></p><p>我们通常使用<code>redis</code>作为数据缓存，当请求进来时先通过<code>key</code>去<code>redis</code>缓存查询，如果缓存中数据不存在，需要去查询数据库的数据。当数据库和缓存中都不存在的数据来查询时候，请求都打在数据库的请求中。如果这种请求量很大，会给数据库造成更大的压力进而影响系统的性能。</p><p><a href="https://img2018.cnblogs.com/blog/1534894/201912/1534894-20191207205359267-68051944.jpg" target="_blank" rel="noopener"><img src="https://img2018.cnblogs.com/blog/1534894/201912/1534894-20191207205359267-68051944.jpg" alt="img"></a></p><p><strong>解决这类问题的方法</strong></p><blockquote><p>方法一:当DB和redis中都不存在<code>key</code>，在DB返回<code>null</code>时，在redis中插入``当<code>key</code>再次请求时,redis直接返回<code>null</code>，而不用再次请求DB。</p></blockquote><blockquote><p>方法二:使用redis提供的<code>redisbloom</code>，同样是将存在的key放入到过滤器中。当请求进来时，先去过滤器中校验是否存在，如果不存在直接返回<code>null</code>。</p></blockquote><p><a href="https://img2018.cnblogs.com/blog/1534894/201912/1534894-20191207205415414-1027574260.jpg" target="_blank" rel="noopener"><img src="https://img2018.cnblogs.com/blog/1534894/201912/1534894-20191207205415414-1027574260.jpg" alt="img"></a><br><strong>黑名单的小例子</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Copyimport redis</span><br><span class="line"><span class="keyword">from</span> redisbloom.client <span class="keyword">import</span> Client</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个连接池来进行使用</span></span><br><span class="line">pool = redis.ConnectionPool(host=<span class="string">'192.168.12.78'</span>, port=<span class="number">6379</span>, max_connections=<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_key</span><span class="params">(key, error, capacity)</span>:</span></span><br><span class="line">    rb = Client(connection_pool=pool)</span><br><span class="line">    rb.bfCreate(key, errorRate=error, capacity=capacity)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_item</span><span class="params">(key, item)</span>:</span></span><br><span class="line">    <span class="string">"""判断是否存在"""</span></span><br><span class="line">    rb = Client(connection_pool=pool)</span><br><span class="line">    <span class="keyword">return</span> rb.bfExists(key, item)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_item</span><span class="params">(key, item)</span>:</span></span><br><span class="line">    <span class="string">"""添加值"""</span></span><br><span class="line">    rb = Client(connection_pool=pool)</span><br><span class="line">    <span class="keyword">return</span> rb.bfAdd(key, item)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># 添加黑名单, 误差为0.001， 大小为1000</span></span><br><span class="line">    create_key(<span class="string">'blacklist'</span>, <span class="number">0.001</span>, <span class="number">1000</span>)</span><br><span class="line">    add_item(<span class="string">'blacklist'</span>, <span class="string">'user:1'</span>)</span><br><span class="line">    add_item(<span class="string">'blacklist'</span>, <span class="string">'user:2'</span>)</span><br><span class="line">    add_item(<span class="string">'blacklist'</span>, <span class="string">'user:3'</span>)</span><br><span class="line">    add_item(<span class="string">'blacklist'</span>, <span class="string">'user:4'</span>)</span><br><span class="line">    print(<span class="string">'user:1是否在黑名单-&gt; '</span>, get_item(<span class="string">'blacklist'</span>, <span class="string">'user:1'</span>))</span><br><span class="line">    print(<span class="string">'user:2是否在黑名单-&gt; '</span>, get_item(<span class="string">'blacklist'</span>, <span class="string">'user:2'</span>))</span><br><span class="line">    print(<span class="string">'user:6是否在黑名单-&gt; '</span>, get_item(<span class="string">'blacklist'</span>, <span class="string">'user:6'</span>))</span><br></pre></td></tr></table></figure><h1 id="HyperLogLog"><a href="#HyperLogLog" class="headerlink" title="HyperLogLog"></a>HyperLogLog</h1><p>​ HyperLogLog是一种类似于布隆过滤器的算法。如果Google要计算用户执行的不同搜索的数量，或者Amazon要计算当天用户浏览的不同商品的数量，要回答这些问题，需要耗用大量的空间！对Google来说，必须有一个日志，其中包含用户执行的不同搜索。有用户执行搜索时，Google必须判断该搜索是否包含在日志中：如果答案是否定的，就必须将其加入到日志中。即便只记录一天的搜索，这种日志也大得不得了！<br>​ HyperLogLog近似地计算集合中不同的元素数，与布隆过滤器一样，它不能给出准确的答案，但也八九不离十，而占用的内存空间却少得多。<br>​ 面临海量数据且只要求答案八九不离十时，可考虑使用概率型算法！</p></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">轻北</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://www.qing-bei.com/2020/07/01/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8%E5%92%8CHyperLogLog/">http://www.qing-bei.com/2020/07/01/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8%E5%92%8CHyperLogLog/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/">布隆过滤器</a><a class="post-meta__tags" href="/tags/%E6%90%9C%E7%B4%A2%E7%AE%97%E6%B3%95/">搜索算法</a><a class="post-meta__tags" href="/tags/HyperLogLog/">HyperLogLog</a></div><div class="post_share"><div class="social-share" data-image="https://wx2.sbimg.cn/2020/06/16/pexels-photo-2194062.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"><i class="fa fa-qrcode"></i> Donate<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="https://wx2.sbimg.cn/2020/06/09/IMG_20200609_094422.jpg" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="https://wx2.sbimg.cn/2020/06/09/IMG_20200609_094512.jpg" alt="支付寶"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/07/10/Python%20bcrypt%E6%A8%A1%E5%9D%97/"><img class="prev_cover" src="https://wx2.sbimg.cn/2020/06/16/pexels-photo-2194062.jpg" onerror='onerror=null,src="/img/404.jpg"'><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Python bcrypy模块</div></div></a></div><div class="next-post pull_right"><a href="/2020/06/18/Hive%E5%86%85%E5%B5%8C%E6%A8%A1%E5%BC%8F%E5%AE%89%E8%A3%85/"><img class="next_cover" src="https://wx2.sbimg.cn/2020/06/09/16pic_7913129_b.jpg" onerror='onerror=null,src="/img/404.jpg"'><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Hive内嵌安装、本地安装和常见属性配置</div></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> Comment</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var requestSetting=function(e,a){var e=e,d=a.split(",").filter(function(a){return e.indexOf(a)>-1});return d=0==d.length?e:d},guestInfo=requestSetting(["nick","mail","link"],"nick,mail,link"),requiredFields=requestSetting(["nick","mail","link"],"nick,mail");window.valine=new Valine({el:"#vcomment",appId:"SOztNhjDgvdFwsXY09QPjNwU-gzGzoHsz",appKey:"RhybWYtt4u2WNJhzFkrVgoJ2",notify:!1,verify:!1,placeholder:"Please leave your footprints",avatar:"monsterid",meta:guestInfo,pageSize:"10",lang:"en",recordIP:!0,serverURLs:"",emojiCDN:"//i0.hdslb.com/bfs/emote/",emojiMaps:{tv_doge:"6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png","tv_親親":"a8111ad55953ef5e3be3327ef94eb4a39d535d06.png","tv_偷笑":"bb690d4107620f1c15cff29509db529a73aee261.png","tv_再見":"180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png","tv_冷漠":"b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png","tv_發怒":"34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png","tv_發財":"34db290afd2963723c6eb3c4560667db7253a21a.png","tv_可愛":"9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png","tv_吐血":"09dd16a7aa59b77baa1155d47484409624470c77.png","tv_呆":"fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png","tv_嘔吐":"9f996894a39e282ccf5e66856af49483f81870f3.png","tv_困":"241ee304e44c0af029adceb294399391e4737ef2.png","tv_壞笑":"1f0b87f731a671079842116e0991c91c2c88645a.png","tv_大佬":"093c1e2c490161aca397afc45573c877cdead616.png","tv_大哭":"23269aeb35f99daee28dda129676f6e9ea87934f.png","tv_委屈":"d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png","tv_害羞":"a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png","tv_尷尬":"7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png","tv_微笑":"70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png","tv_思考":"90cf159733e558137ed20aa04d09964436f618a1.png","tv_驚嚇":"0d15c7e2ee58e935adc6a7193ee042388adc22af.png"},enableQQ:!0,requiredFields:requiredFields})</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By 轻北</div><div class="icp"><a href="http://www.beian.gov.cn/" target="_blank" rel="noopener"><img class="icp-icon" src="https://wx2.sbimg.cn/2020/06/08/74537af458689411e284d6441c415a44.png"><span>湘公网安备4301240200591号</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="Read Mode"></i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="Traditional Chinese and Simplified Chinese Conversion" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="Dark Mode"></i></div><div id="rightside-config-show"><div id="rightside_config" title="Setting"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="Scroll to comment"><i class="scroll_to_comment fa fa-comments"></i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="Table of Contents" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="Back to top" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script id="ribbon_piao" mobile="true" src="/js/third-party/piao.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zindex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@3/instantpage.min.js" type="module"></script><script src="/js/third-party/ClickShowText.js"></script><script src="/js/search/local-search.js"></script><script src="https://player.lmih.cn/player/js/player.js" id="myhk" key="159195086280" m="1"></script></body></html><!-- rebuild by neat -->